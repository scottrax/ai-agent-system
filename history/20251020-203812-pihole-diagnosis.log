========================================================================
                    PI-HOLE DIAGNOSTIC REPORT
========================================================================

TIMESTAMP: 2025-10-20 20:37:42 UTC
SYSTEM: Ubuntu 24.04.3 LTS (Noble Numbat) - Linux 6.8.0-85-generic x86_64

========================================================================
SERVICE STATUS SUMMARY
========================================================================

PRIMARY SERVICE:
  pihole-FTL.service - Pi-hole FTL
  Status: ACTIVE (running since 2025-10-20 20:37:38 UTC)
  Uptime: Fresh restart (4 seconds old)
  PID: 64153
  Memory: 25.5M (peak 26.4M)
  CPU: 1.381s

DEPENDENT SERVICES:
  unbound.service - Unbound DNS server
  Status: ACTIVE (running since 2025-10-17 23:18:20 UTC)
  Memory: 12.4M (peak 13.1M)
  Note: Warnings about so-rcvbuf and subnetcache noted

  cloudflared.service - Cloudflare Tunnel
  Status: ACTIVE (running since 2025-10-20 01:14:47 UTC)
  Memory: 15.6M (peak 18.5M)
  Note: Recent warnings about stream listener failures (non-critical)

========================================================================
NETWORK LISTENING PORTS
========================================================================

DNS Services:
  UDP 0.0.0.0:53 (pihole-FTL) - DNS over UDP
  UDP [::]:53 (pihole-FTL) - DNS over IPv6 UDP
  TCP 0.0.0.0:53 (pihole-FTL) - DNS over TCP
  TCP [::]:53 (pihole-FTL) - DNS over IPv6 TCP

Web Interface:
  TCP 0.0.0.0:80 (pihole-FTL) - HTTP
  TCP 0.0.0.0:443 (pihole-FTL) - HTTPS
  TCP [::]:80 (pihole-FTL) - IPv6 HTTP
  TCP [::]:443 (pihole-FTL) - IPv6 HTTPS

Upstream DNS:
  UDP 127.0.0.1:5335 (unbound) - Local recursive resolver
  UDP *:56101 (cloudflared) - Cloudflare tunnel

Other:
  TCP 0.0.0.0:8000 - ai-agent-web service

========================================================================
FUNCTIONAL TESTS
========================================================================

DNS Resolution Test:
  dig @localhost example.com
  RESULT: PASS (resolved to 23.220.75.232, 23.192.228.84, etc.)

Web Interface HTTP Status:
  curl -I http://localhost/
  RESULT: 403 Forbidden (expected - requires authentication/token)
  Headers indicate security policies in place (CSP, X-Frame-Options, etc.)

API Authentication Check:
  curl http://localhost/api/auth
  RESULT: FAIL - Requires valid session ID (SID)
  Response: session.valid=false, sid=null (expected unauthenticated state)

========================================================================
CONFIGURATION STATUS
========================================================================

Version Information:
  Core: v6.1.4 (Latest: v6.1.4) ✓ UP TO DATE
  Web: v6.2.1 (Latest: v6.2.1) ✓ UP TO DATE
  FTL: v6.2.3 (Latest: v6.2.3) ✓ UP TO DATE

Configuration Files:
  /etc/pihole/pihole.toml - Present and parsed successfully
  /etc/pihole/dnsmasq.conf - Present (6587 bytes)
  /etc/pihole/gravity.db - Present (91M - database)
  /etc/pihole/cli_pw - Present (password file)
  /etc/pihole/dhcp.leases - Present (DHCP lease database)

Upstream DNS Configuration:
  Primary: 127.0.0.1#5335 (unbound - recursive resolver)
  Secondary: 1.1.1.1 (Cloudflare - fallback)

========================================================================
RESOURCE UTILIZATION
========================================================================

Disk Space:
  Mount: /dev/mapper/ubuntu--vg-ubuntu--lv
  Size: 23G
  Used: 15G
  Available: 7.7G
  Usage: 65%
  Status: ✓ ADEQUATE (65% < 85% threshold)

Memory:
  Total: 31Gi
  Used: 977Mi
  Free: 23Gi
  Available: 30Gi
  Swap: 5.2Gi (unused)
  Status: ✓ EXCELLENT

========================================================================
DIAGNOSTICS & FINDINGS
========================================================================

HEALTHY:
  1. All three core services running and enabled
  2. All versions up-to-date and current
  3. DNS resolution working correctly
  4. All listening ports configured and active
  5. Adequate disk and memory resources
  6. Configuration files present and valid
  7. FTL process healthy after restart
  8. Unbound DNS server operational
  9. Cloudflare tunnel established and tunneling

WARNINGS (NON-BLOCKING):
  1. Unbound: so-rcvbuf not fully allocated (kernel tuning issue)
     - Severity: LOW
     - Impact: Minor performance impact on DNS buffer sizes
     - Fix: sysctl net.core.rmem_max tuning (optional)

  2. Cloudflared: Occasional stream listener warnings
     - Severity: LOW
     - Impact: Transient tunnel reconnections
     - Fix: Normal operation, auto-recovery in place

  3. Web Interface: Returns 403 without authentication
     - Severity: NONE (correct behavior)
     - Impact: Security feature working as designed
     - Fix: Provide valid authentication token to access UI

POTENTIAL ISSUES EXAMINED & CLEARED:
  - Service not running as systemd unit: FIXED (properly enabled)
  - API not accessible: VERIFIED (API exists, requires auth)
  - DNS not resolving: VERIFIED WORKING (successful test query)
  - Disk space issues: VERIFIED ADEQUATE (65% used)
  - Memory issues: VERIFIED ABUNDANT (mostly free)

========================================================================
RECOMMENDATIONS
========================================================================

IMMEDIATE ACTIONS:
  None required. Pi-hole is operational.

OPTIONAL OPTIMIZATIONS:
  1. Tune unbound buffer sizes for better DNS performance:
     sudo sysctl -w net.core.rmem_max=2097152

  2. Monitor disk usage (currently 65% - recheck if exceeds 80%)

  3. Review blocklists in gravity.db if ad-blocking seems ineffective

  4. Check cloudflared tunnel status if connectivity issues arise

MONITORING:
  - Watch systemctl status for each service
  - Monitor /var/log/pihole/FTL.log for errors
  - Use web UI at http://localhost/admin/ for statistics
  - Check DNS resolution regularly: dig @localhost

========================================================================
                          CONCLUSION
========================================================================

STATUS: ✓ OPERATIONAL - No critical issues identified

Pi-hole is functioning correctly with all core components healthy:
  - FTL DNS/DHCP engine: RUNNING
  - Unbound recursive resolver: RUNNING
  - Cloudflare tunnel: RUNNING
  - Web interface: AVAILABLE (authenticated)
  - DNS queries: RESOLVING

The system is ready for production use.

========================================================================
